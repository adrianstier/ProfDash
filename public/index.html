<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfDash - Academic Productivity Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeMobileMenu()"></div>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1 class="sidebar-logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
                ProfDash
            </h1>
            <button class="sidebar-collapse-btn" onclick="toggleSidebar()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Daily Work</div>
            <button class="sidebar-btn sidebar-btn--active" data-view="today" onclick="switchView('today')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span>Today</span>
            </button>
            <button class="sidebar-btn" data-view="upcoming" onclick="switchView('upcoming')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Upcoming</span>
            </button>
            <button class="sidebar-btn" data-view="pulse" onclick="switchView('pulse')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                </svg>
                <span>Pulse</span>
            </button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Views</div>
            <button class="sidebar-btn" data-view="board" onclick="switchView('board')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                <span>Board</span>
            </button>
            <button class="sidebar-btn" data-view="list" onclick="switchView('list')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
                <span>List</span>
            </button>
            <button class="sidebar-btn" data-view="calendar" onclick="switchView('calendar')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Calendar</span>
            </button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Research & Grants</div>
            <button class="sidebar-btn" data-view="pipeline" onclick="switchView('pipeline')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                </svg>
                <span>Paper Pipeline</span>
                <span class="sidebar-badge" id="pipeline-badge">0</span>
            </button>
            <button class="sidebar-btn" data-view="grants" onclick="switchView('grants')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                </svg>
                <span>Grants</span>
                <span class="sidebar-badge" id="grants-badge">0</span>
            </button>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-title">Lab & Teaching</div>
            <button class="sidebar-btn" data-view="personnel" onclick="switchView('personnel')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <span>Lab Personnel</span>
                <span class="sidebar-badge" id="personnel-badge">0</span>
            </button>
            <button class="sidebar-btn" data-view="teaching" onclick="switchView('teaching')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                <span>Teaching</span>
            </button>
            <button class="sidebar-btn" data-view="dossier" onclick="switchView('dossier')">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
                <span>Dossier Builder</span>
            </button>
        </div>

        <div class="sidebar-section sidebar-filters">
            <div class="sidebar-section-title">Filter by Category</div>
            <button class="sidebar-filter sidebar-filter--active" data-filter="all" onclick="setFilter('all')">
                <span class="sidebar-filter-dot sidebar-filter-dot--all"></span>
                All Tasks
                <span class="sidebar-filter-count" id="count-all">0</span>
            </button>
            <button class="sidebar-filter" data-filter="research" onclick="setFilter('research')">
                <span class="sidebar-filter-dot sidebar-filter-dot--research"></span>
                Research
                <span class="sidebar-filter-count" id="count-research">0</span>
            </button>
            <button class="sidebar-filter" data-filter="teaching" onclick="setFilter('teaching')">
                <span class="sidebar-filter-dot sidebar-filter-dot--teaching"></span>
                Teaching
                <span class="sidebar-filter-count" id="count-teaching">0</span>
            </button>
            <button class="sidebar-filter" data-filter="grants" onclick="setFilter('grants')">
                <span class="sidebar-filter-dot sidebar-filter-dot--grants"></span>
                Grants
                <span class="sidebar-filter-count" id="count-grants">0</span>
            </button>
            <button class="sidebar-filter" data-filter="grad-mentorship" onclick="setFilter('grad-mentorship')">
                <span class="sidebar-filter-dot sidebar-filter-dot--grad"></span>
                Grad Mentorship
                <span class="sidebar-filter-count" id="count-grad-mentorship">0</span>
            </button>
            <button class="sidebar-filter" data-filter="undergrad-mentorship" onclick="setFilter('undergrad-mentorship')">
                <span class="sidebar-filter-dot sidebar-filter-dot--undergrad"></span>
                Undergrad Mentorship
                <span class="sidebar-filter-count" id="count-undergrad-mentorship">0</span>
            </button>
            <button class="sidebar-filter" data-filter="admin" onclick="setFilter('admin')">
                <span class="sidebar-filter-dot sidebar-filter-dot--admin"></span>
                Service/Admin
                <span class="sidebar-filter-count" id="count-admin">0</span>
            </button>
            <button class="sidebar-filter" data-filter="misc" onclick="setFilter('misc')">
                <span class="sidebar-filter-dot sidebar-filter-dot--misc"></span>
                Miscellaneous
                <span class="sidebar-filter-count" id="count-misc">0</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="top-bar-left">
                <div class="search-box">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="search-input" placeholder="Search tasks... (press /)" oninput="handleSearch(this.value)">
                </div>
            </div>
            <div class="top-bar-right">
                <div class="streak-display" id="streak-display" title="Current streak">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    <span id="streak-count">0</span> day streak
                </div>
                <button class="top-bar-btn" onclick="openNewTaskModal()" title="New Task (N)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    New Task
                </button>
            </div>
        </header>

        <!-- Quick Add Bar -->
        <div class="quick-add">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <input type="text" id="quick-add-input" placeholder="Quick add: 'NSF report fri #grants p1' (Q to focus)" onkeydown="handleQuickAddKey(event)">
            <button class="quick-add-btn" onclick="submitQuickAdd()">Add</button>
        </div>

        <!-- Today View (Default) -->
        <div class="view-container view-container--active" id="view-today">
            <div class="today-header">
                <div class="today-title">
                    <h2>Today</h2>
                    <span class="today-date" id="today-date"></span>
                </div>
                <div class="today-progress">
                    <div class="today-progress-text">
                        <span id="today-done">0</span> of <span id="today-total">0</span> tasks done
                    </div>
                    <div class="today-progress-bar">
                        <div class="today-progress-fill" id="today-progress-fill"></div>
                    </div>
                </div>
            </div>
            <div class="today-content" id="today-tasks">
                <!-- Tasks rendered here -->
            </div>
        </div>

        <!-- Upcoming View -->
        <div class="view-container" id="view-upcoming">
            <div class="upcoming-header">
                <h2>Upcoming</h2>
                <span class="upcoming-subtitle">Next 14 days</span>
            </div>
            <div class="upcoming-content" id="upcoming-tasks">
                <!-- Upcoming tasks rendered here -->
            </div>
        </div>

        <!-- Board View -->
        <div class="view-container" id="view-board">
            <div class="board-header">
                <h2>Board</h2>
            </div>
            <div class="board-columns">
                <div class="column">
                    <div class="column-header">
                        <h3>To Do</h3>
                        <span class="column-count" id="stat-todo">0</span>
                    </div>
                    <div class="column-tasks" id="tasks-todo">
                        <!-- To Do tasks -->
                    </div>
                    <button class="column-add-btn" onclick="openNewTaskModal('todo')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Task
                    </button>
                </div>
                <div class="column">
                    <div class="column-header column-header--progress">
                        <h3>In Progress</h3>
                        <span class="column-count" id="stat-progress">0</span>
                    </div>
                    <div class="column-tasks" id="tasks-progress">
                        <!-- In Progress tasks -->
                    </div>
                    <button class="column-add-btn" onclick="openNewTaskModal('progress')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Task
                    </button>
                </div>
                <div class="column">
                    <div class="column-header column-header--done">
                        <h3>Done</h3>
                        <span class="column-count" id="stat-done">0</span>
                    </div>
                    <div class="column-tasks" id="tasks-done">
                        <!-- Done tasks -->
                    </div>
                    <button class="column-clear-btn" onclick="clearDoneTasks()">Clear Completed</button>
                </div>
            </div>
        </div>

        <!-- List View -->
        <div class="view-container" id="view-list">
            <div class="list-header">
                <h2>All Tasks</h2>
            </div>
            <div class="list-table-container">
                <table class="list-table">
                    <thead>
                        <tr>
                            <th>Task</th>
                            <th>Category</th>
                            <th>Priority</th>
                            <th>Due</th>
                            <th>Status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="list-body">
                        <!-- List rows -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Calendar View -->
        <div class="view-container" id="view-calendar">
            <div class="calendar-header">
                <h2 id="calendar-month">December 2025</h2>
                <div class="calendar-nav">
                    <button onclick="prevMonth()" class="calendar-nav-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <button onclick="nextMonth()" class="calendar-nav-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                <div class="calendar-days" id="calendar-days">
                    <!-- Calendar days rendered here -->
                </div>
            </div>
        </div>

        <!-- Pulse View -->
        <div class="view-container" id="view-pulse">
            <div class="pulse-header">
                <h2>Pulse</h2>
                <span class="pulse-subtitle">Your productivity overview</span>
            </div>
            <div class="pulse-content" id="pulse-content">
                <!-- Pulse metrics rendered here -->
            </div>
        </div>

        <!-- Pipeline View -->
        <div class="view-container" id="view-pipeline">
            <div class="pipeline-header">
                <h2>Paper Pipeline</h2>
                <button class="top-bar-btn" onclick="openPaperModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Paper
                </button>
            </div>
            <div class="pipeline-kanban" id="pipeline-kanban">
                <!-- Pipeline columns rendered here -->
            </div>
        </div>

        <!-- Grants View -->
        <div class="view-container" id="view-grants">
            <div class="grants-header">
                <h2>Grants</h2>
                <button class="top-bar-btn" onclick="openGrantModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Grant
                </button>
            </div>
            <div class="grants-content" id="grants-content">
                <!-- Grants rendered here -->
            </div>
        </div>

        <!-- Personnel View -->
        <div class="view-container" id="view-personnel">
            <div class="personnel-header">
                <h2>Lab Personnel</h2>
                <button class="top-bar-btn" onclick="openPersonnelModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Person
                </button>
            </div>
            <div class="personnel-content" id="personnel-content">
                <!-- Personnel cards rendered here -->
            </div>
        </div>

        <!-- Teaching View -->
        <div class="view-container" id="view-teaching">
            <div class="teaching-header">
                <h2>Teaching</h2>
                <button class="top-bar-btn" onclick="openCourseModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Course
                </button>
            </div>
            <div class="teaching-content" id="teaching-content">
                <!-- Teaching dashboard rendered here -->
            </div>
        </div>

        <!-- Dossier View -->
        <div class="view-container" id="view-dossier">
            <div class="dossier-header">
                <h2>Dossier Builder</h2>
                <span class="dossier-subtitle">Organize your promotion materials</span>
            </div>
            <div class="dossier-content" id="dossier-content">
                <!-- Dossier sections rendered here -->
            </div>
        </div>
    </main>

    <!-- Task Modal -->
    <div class="modal-overlay" id="task-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modal-title">New Task</h2>
                <button class="modal-close" onclick="closeModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="task-form" onsubmit="saveTask(event)">
                <div class="form-group">
                    <label for="task-title">Title</label>
                    <input type="text" id="task-title" required placeholder="What needs to be done?">
                </div>
                <div class="form-group">
                    <label for="task-description">Description</label>
                    <textarea id="task-description" rows="2" placeholder="Add more details..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-category">Category</label>
                        <select id="task-category">
                            <option value="research">Research</option>
                            <option value="teaching">Teaching</option>
                            <option value="grants">Grants</option>
                            <option value="grad-mentorship">Grad Mentorship</option>
                            <option value="undergrad-mentorship">Undergrad Mentorship</option>
                            <option value="admin">Service/Admin</option>
                            <option value="misc">Miscellaneous</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-priority">Priority</label>
                        <select id="task-priority">
                            <option value="medium">Medium</option>
                            <option value="urgent">Urgent</option>
                            <option value="high">High</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-status">Status</label>
                        <select id="task-status">
                            <option value="todo">To Do</option>
                            <option value="progress">In Progress</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-due">Due Date</label>
                        <input type="date" id="task-due">
                    </div>
                </div>
                <div class="form-group">
                    <label for="task-notes">Notes</label>
                    <textarea id="task-notes" rows="2" placeholder="Additional notes..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal-overlay" id="detail-modal">
        <div class="modal modal--detail">
            <div class="modal-header">
                <h2 id="detail-title">Task Details</h2>
                <button class="modal-close" onclick="closeDetailModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div id="detail-content">
                <!-- Task details rendered here -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-danger" onclick="deleteCurrentTask()">Delete</button>
                <button type="button" class="btn-primary" onclick="editCurrentTask()">Edit</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Supabase Config (will be replaced by server-side config) -->
    <script>
        window.SUPABASE_CONFIG = {
            url: 'YOUR_SUPABASE_URL',
            anonKey: 'YOUR_SUPABASE_ANON_KEY'
        };
    </script>
    <script src="js/database.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
